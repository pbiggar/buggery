#!/usr/bin/env python

import string
import pprint
import sys
import os
import glob
import re
from optparse import OptionParser # use optparse rather than argparse since it's portable between versions, not just 2.7 and beyond.


try:
  from buggery import Parser
except ImportError, e:
  if str(e) == 'No module named ply.lex' or str(e) == 'No module named ply.yacc':
    sys.exit(
"""PLY (Python Lex-Yacc) library required.

  On ubuntu:
    $ apt-get install python-ply

  Otherwise, download and install from http://www.dabeaz.com/ply/
""")
  raise e


#raise Exception("No top-level task named: " + name)


#######################
# Command-line options
#######################

def parse_command_line():
  parser = OptionParser()
  return parser.parse_args(sys.argv)

(options, args) = parse_command_line()
filename = args[1] # The buggery file is always the first command
args = args[2:]
print "Running %s with args %s" % (filename, str(args))

# Parse the buggery file
input = file(filename).read()
bugger = Parser().parse(input)

##############################################
# Process post-reading command-line options
##############################################


##############################################
# Start processing tasks
##############################################

# Always run the startup task
bugger.run("startup")
